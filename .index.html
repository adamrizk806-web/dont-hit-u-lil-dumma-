<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro Face Racer Pro</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; touch-action: manipulation; }
        canvas { display: block; margin: 0 auto; background: #222; image-rendering: pixelated; }
        
        /* UI Styling */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #0f0; background: rgba(0,0,0,0.9); z-index: 10; text-align: center; }
        .btn { padding: 12px 20px; margin: 5px; font-size: 16px; cursor: pointer; background: #000; border: 2px solid #0f0; color: #0f0; font-family: inherit; }
        .btn:hover { background: #0f0; color: #000; }
        
        #stats { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; color: #0f0; font-size: 18px; pointer-events: none; font-weight: bold; }
        
        /* Mobile Controls */
        #controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; pointer-events: none; }
        .touch-btn { width: 70px; height: 70px; background: rgba(0, 255, 0, 0.1); border: 2px solid #0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #0f0; font-size: 24px; pointer-events: auto; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="stats">
        <div>SCORE: <span id="score-val">0</span></div>
        <div>ðŸ’°: <span id="coin-val">0</span></div>
    </div>

    <div id="overlay">
        <h1 style="text-shadow: 3px 3px #f0f;">RETRO RACER PRO</h1>
        <div id="menu-main">
            <button class="btn" style="font-size: 22px;" onclick="startGame()">START MISSION</button>
            <div style="margin-top: 20px;">
                <p>SELECT MAP:</p>
                <button class="btn" onclick="setMap('city')">CITY</button>
                <button class="btn" onclick="setMap('desert')">DESERT</button>
                <button class="btn" onclick="setMap('cyber')">CYBER</button>
            </div>
            <div style="margin-top: 20px;">
                <p>GARAGE:</p>
                <button class="btn" onclick="buySkin(1, 50)">POLO (50ðŸ’°)</button>
                <button class="btn" onclick="buySkin(2, 100)">SPORT (100ðŸ’°)</button>
            </div>
        </div>
    </div>

    <div id="controls">
        <div class="touch-btn" id="leftBtn">â—€</div>
        <div class="touch-btn" id="rightBtn">â–¶</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = Math.min(window.innerWidth, 400);
canvas.height = window.innerHeight;

/** MAP CONFIGS **/
const MAPS = {
    city: { road: "#444", grass: "#2d2d2d", line: "#fff" },
    desert: { road: "#c2a37e", grass: "#edc9af", line: "#fff" },
    cyber: { road: "#1a1a2e", grass: "#0f0524", line: "#f0f" }
};
let activeMap = "city";

/** ASSETS **/
const faceFiles = ['IMG-20250310-WA0003.jpg', '20250713_141328.jpg', '20251226_142618.jpg', '20251006_101403.jpg'];
const faceImgs = faceFiles.map(src => { const img = new Image(); img.src = src; return img; });

const CAR_STYLES = [
    { color: "#e74c3c", trim: "#96281b" }, // Beanie Red
    { color: "#8e44ad", trim: "#4d05ad" }, // Polo Purple
    { color: "#3498db", trim: "#1f3a93" }, // Sport Blue
    { color: "#27ae60", trim: "#1e824c" }  // Van Green
];

/** GAME STATE **/
let score = 0, coins = parseInt(localStorage.getItem("coins")) || 0;
let unlocked = JSON.parse(localStorage.getItem("unlocked")) || [0];
let activeSkin = 0, gameState = "MENU", gameSpeed = 6;
let playerX = canvas.width / 2 - 25, enemies = [], roadCoins = [];
const keys = {};

// Inputs
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);
let touchL = false, touchR = false;
document.getElementById("leftBtn").ontouchstart = (e) => { e.preventDefault(); touchL = true; };
document.getElementById("leftBtn").ontouchend = () => touchL = false;
document.getElementById("rightBtn").ontouchstart = (e) => { e.preventDefault(); touchR = true; };
document.getElementById("rightBtn").ontouchend = () => touchR = false;

function setMap(m) { activeMap = m; alert("Map set to " + m.toUpperCase()); }
function buySkin(idx, cost) {
    if (unlocked.includes(idx)) { activeSkin = idx; alert("Equipped!"); }
    else if (coins >= cost) { coins -= cost; unlocked.push(idx); activeSkin = idx; save(); updateUI(); alert("Unlocked!"); }
    else alert("Need more coins!");
}
function save() { localStorage.setItem("coins", coins); localStorage.setItem("unlocked", JSON.stringify(unlocked)); }
function updateUI() { document.getElementById("score-val").innerText = score; document.getElementById("coin-val").innerText = coins; }

function startGame() {
    document.getElementById("overlay").classList.add("hidden");
    score = 0; gameSpeed = 7; enemies = []; roadCoins = []; playerX = canvas.width / 2 - 25; gameState = "PLAYING";
    updateUI();
}

/** RETRO DRAWING ENGINE **/
function drawRetroCar(x, y, index) {
    const style = CAR_STYLES[index];
    const w = 50, h = 80;

    // Body
    ctx.fillStyle = style.trim;
    ctx.fillRect(x, y, w, h); // Main base
    ctx.fillStyle = style.color;
    ctx.fillRect(x + 4, y + 2, w - 8, h - 4); // Inner body

    // Spoiler
    ctx.fillStyle = style.trim;
    ctx.fillRect(x - 2, y + h - 8, w + 4, 5);

    // Windshield (The Face)
    ctx.fillStyle = "#000";
    ctx.fillRect(x + 8, y + 12, w - 16, 32);
    if (faceImgs[index].complete && faceImgs[index].naturalWidth !== 0) {
        ctx.drawImage(faceImgs[index], x + 10, y + 14, w - 20, 28);
    } else {
        ctx.fillStyle = "#0ff";
        ctx.fillRect(x + 10, y + 14, w - 20, 28);
    }

    // Wheels
    ctx.fillStyle = "#111";
    ctx.fillRect(x - 6, y + 10, 6, 18); ctx.fillRect(x + w, y + 10, 6, 18);
    ctx.fillRect(x - 6, y + 55, 6, 18); ctx.fillRect(x + w, y + 55, 6, 18);
}

function update() {
    if (gameState !== "PLAYING") return;

    if ((keys['ArrowLeft'] || touchL) && playerX > 20) playerX -= 8;
    if ((keys['ArrowRight'] || touchR) && playerX < canvas.width - 70) playerX += 8;

    // Harder Spawning
    if (Math.random() < 0.03 + (score * 0.0005)) {
        enemies.push({ x: Math.random() * (canvas.width - 60), y: -100, skin: Math.floor(Math.random() * 4) });
    }
    if (Math.random() < 0.01) roadCoins.push({ x: Math.random() * (canvas.width - 20), y: -50 });

    enemies.forEach((en, i) => {
        en.y += gameSpeed;
        if (en.y > canvas.height) { enemies.splice(i, 1); score += 10; updateUI(); }
        // Collision logic
        if (playerX < en.x + 45 && playerX + 45 > en.x && canvas.height - 130 < en.y + 75 && canvas.height - 130 + 75 > en.y) {
            gameState = "MENU";
            document.getElementById("overlay").classList.remove("hidden");
            document.getElementById("score-val").innerText = score;
            save();
        }
    });

    roadCoins.forEach((c, i) => {
        c.y += gameSpeed;
        if (playerX < c.x + 20 && playerX + 50 > c.x && canvas.height - 130 < c.y + 20 && canvas.height - 130 + 80 > c.y) {
            coins += 5; roadCoins.splice(i, 1); updateUI();
        }
    });

    gameSpeed += 0.002; // Constantly getting faster
}

function draw() {
    const map = MAPS[activeMap];
    
    // Draw Grass/Side
    ctx.fillStyle = map.grass;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw Road
    ctx.fillStyle = map.road;
    ctx.fillRect(20, 0, canvas.width - 40, canvas.height);

    // Road Lines
    ctx.fillStyle = map.line;
    for(let i=0; i<canvas.height; i+=80) {
        ctx.fillRect(canvas.width/2 - 4, (i + Date.now()/15) % canvas.height, 8, 40);
    }

    if (gameState === "PLAYING") {
        drawRetroCar(playerX, canvas.height - 130, activeSkin);
        enemies.forEach(en => drawRetroCar(en.x, en.y, en.skin));
        roadCoins.forEach(c => {
            ctx.fillStyle = "#ff0";
            ctx.fillRect(c.x, c.y, 15, 15); // Pixel-style coins
        });
    }

    update();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
